---
title: "FlexDB_1"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    source_code: embed
    theme: lumen
    vertical_layout: fill
runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(shiny)        #renderPlot, renderTable, sliderInput
library(shinyWidgets) #radioGroupButtons

```

```{r data input}

#read output datasets from DB

#read transaction datasets if necessary 

data_input = read.csv('./Product_datasheets.xlsx - DB_output.csv')

raw_data = data_input
```

ReACTIVATE Dashboard for supermarket employees
=====================================
Column {.sidebar data-width=200} 
-------------------------------------
Filter the data:

```{r filters}
# You can make this sidebar global by putting it ahead of Tab 1
# below are 2 input options: a gorup of buttons, and a slider
data = raw_data

discount_range = seq(0, 100, by=5)
selected_range = as.numeric(data$Discount_predictions[!is.na(data$Discount_predictions)])


# add numeric input to filter remaining fresh days 

numericInput(
  inputId="freshdays",
  label="Remaining Fresh Days",
  value =3,
  min = 0,
  max = 100,
  step = 1,
  width = NULL
)


# add checkbox to select category 

checkboxGroupInput(
  inputId="category",
  label="Select by Category",
  choices = c("Fruit", "Meat","Yogurt","Drink"),
  selected = "Fruit"
)

# add checkbox to select location ID

checkboxGroupInput(
  inputId="location",
  label="Select by Location",
  choices = c("Fridges","Shelves"),  
  #plz note "Fridges" instead of FRI124(fridge+number in datasheet) is shown here.
  #pay attention when filtering the datasheet, or just simply revise location into fridges/shelves in datasheet 
  selected = "Shelves"
)


radioGroupButtons( # for categorical variables
  inputId = "Discount_percent", # this will allow the selection to be referenced as input$cyl
  label = "Select Discount", # NULL if you don't want a header
  choiceNames = c("20%", paste(selected_range*100,'%')), # can use paste, etc to make nicer display
  choiceValues = c("20%", paste(selected_range*100,'%')), # values in the data, need to line up with above
  justified = TRUE, # will fill the width of the container it sits in (sidebar)
  status = "primary"
)

sliderInput(
  inputId = "Discount_range", # referenced as input$displ
  label = "Select discount label",
  value = discount_range, # default selection, you can move the range around
  min = (min(discount_range)),
  max = (max(discount_range)),
  step = 5
)

#to dos
#product ID 
#location ID buttons
#Quality or Num_freshdays
#category


# This will build a dataframe to use throughout the dashboard. To reference this dataframe, you will need to be in some reactive element ex: renderText({nrow(use_data())}). This is essentially a function and so you will need to use parentheses at the end like this: use_data()

#item is the selected product row or all items of that product? 

# use_data <- reactive({
#   df <-
#     data %>%
#     filter(between(item, min(input$item), max(input$item)))
#   
#   # this if statement will filter for the selection of the radioGroupButtons
#   if (input$year != "All") {
#     df <- df %>% filter(year == input$year)
#   }
#   
#   df
# })

```

Producttable {data-width=350}
-----------------------------------------------------------------------

### Product list and location

```{r table}
#display top 10 items that require attention table here

#this will display a top 10 table that is filtered based on the selections above
# renderTable({ # use {...} for the output (an expression)
#     use_data() %>%
#       arrange(desc(hwy)) %>%
#       slice(1:10) %>%
#       mutate(Rank = row_number()) %>%
#       select(Rank, year, manufacturer, model, trans, hwy, fl, class)
#   },
#   # renderTable takes additional arguments after the {...}
#   spacing = "xs",
#   align = "l",
#   bordered = TRUE
# )

```


### Expiry date indicator: Chart for number of days till expiry of product

```{r}

#LineDiagram {data-width=250}

#line plot to indicate expiry dates of item selected and discount predictions for that item or previous sales with discount to give employee some idea on deciding discount

# renderPlot({ # renderPlot is only required becuase we are referencing someting reactive: use_data(). Otherwise we could just use ggplot(raw_data,...)
#   ggplot(use_data(), aes(displ, hwy)) +
#     geom_smooth(color = "grey65") +
#     geom_point(aes(color = factor(cyl))) +
#     ylim(0, 45) +
#     labs(color = "Cylinder") +
#     theme(legend.position = "bottom")
# })

```
-----------------------------------------------------------------------


PrintLabel {data-width=150} 
-----------------------------------------------------------------------

```{r print function}

radioGroupButtons( # for categorical variables
  inputId = "Print_Discount_percent", # this will allow the selection to be referenced as input$cyl
  label = "PRINT LABEL", # NULL if you don't want a header
  choiceNames = c("None", paste(selected_range*100,'%')), # can use paste, etc to make nicer display
  choiceValues = c("None", paste(selected_range*100,'%')), # values in the data, need to line up with above
  justified = TRUE, # will fill the width of the container it sits in (sidebar)
  status = "primary"
)
```

### Checked products - Counter list of products already checked today

```{r}

```


### To be checked -  Counter list of products to be checked today

```{r}

```

-----------------------------------------------------------------------
